function ChatMessage(data) {
    var self = this;

    self.userName = data.UserName;
    self.userID = data.UserID;
    self.messageContent = data.MessageContent;
    self.whenCreated = data.WhenCreated;
    console.log(this);

    self.userNameInfo = ko.computed(function() {
        return self.userName + ": "
    });
}
function GameLobby(data) {
    this.gameLobbyID = data.gameLobbyID;
    this.gameLobbyName = data.gameLobbyName;
    this.hostUserName = data.hostUserName;
    console.log(this);
}
function User(data) {
    this.userName = data.UserName;
}
function AlertMessageViewModel() {
    var self = this;

    self.title = ko.observable();
    self.message = ko.observable();
    self.isVisible = ko.observable(false);

    self.cssDisplay = ko.computed(function() {
        if(self.isVisible() == true) {
            return "inline";
        }
        else {
            return "none";
        }
    });

    self.activateCard = ko.computed(function() {
        if(self.isVisible()) {
            return "card activate";
        }
        else {
            return "card";
        }
    });

    self.showLoginFailed = function() {
        self.title("Login Error");
        self.message("Incorrect username and/or password");
        self.isVisible(true);
    }

    self.showLoginMissingInput = function() {
        self.title("Login Error");
        self.message("Please fill out username and password fields");
        self.isVisible(true);
    }

    self.showRegisterMissingInput = function() {
        self.title("Registration Error");
        self.message("Please fill out username, email and password fields");
        self.isVisible(true);
    }

    self.showRegisterSuccessful = function() {
        self.title("Registration Successful");
        self.message("Registration has successfully completed");
        self.isVisible(true);
    }

    self.showRegisterUnsuccessful = function() {
        self.title("Registration Error");
        self.message("There already exists a user with the same username or email!");
        self.isVisible(true);
    }
    
    self.confirmMessage = function() {
        self.isVisible(false);
    }
}
function ChatRoomsViewModel(connection) {
    var self = this;

    self.connection = connection;
    self.chatRooms = ko.observableArray();
    self.onlineUsers = ko.observableArray();
    self.selectedChatRoom = ko.observable(new ChatRoomViewModel(self, connection, {"chatRoomName": "", "participants": []}));

    self.onlineUsersCount = ko.computed(function() {
        return self.onlineUsers().length + " Players";
    });

    self.hasChat = ko.computed(function() {
        if(self.chatRooms().length>0) {
            return "inline";
        }
        else {
            return "none";
        }
    });

    self.getChatRooms = function() {
        self.chatRooms.removeAll();
        fetch(webAPIIPAddress + "/api/chatrooms", {
            method: 'GET',
            credentials: 'include'
        }).then(response => {
            response.json().then(function(data) {
                console.log(data);
                data.forEach(function(element) {
                    self.chatRooms.push(new ChatRoomViewModel(self, connection, element));
                });
            });
        })
    }

    self.selectChatRoom = function(chatRoom) {
        if(self.selectedChatRoom() == chatRoom) {
            deactivateCurrentChatRoomCard();
            self.selectedChatRoom(new ChatRoomViewModel(self, connection, {"chatRoomName": "", "participants": []}));
        }
        else {
            activateCurrentChatRoomCard();
            self.selectedChatRoom(chatRoom);
        }
        
    }
}
function ChatRoomViewModel(chatRoomsViewModel, connection, data) {
    var self = this;

    self.chatRoomsViewModel = chatRoomsViewModel;
    self.connection = connection;
    
    self.chatRoomName = ko.observable();
    self.chatMessageInput = ko.observable();
    self.chatMessages = ko.observableArray();
    self.users = ko.observableArray(data.participants);
    self.inChat = ko.observable(false);

    self.usersCount = ko.computed(function() {
        return self.users().length + " Users";
    });

    self.chatRoomName(data.chatRoomName);
    console.log(self.chatRoomName() + " " + data);

    self.sendMessage = function() {
        var message = self.chatMessageInput();
        self.chatMessageInput("");
        self.connection.invoke("ChatSendMessage", message, self.chatRoomName());
    }

    self.joinChatRoom = function() {
        self.connection.invoke('ChatRoomJoin', self.chatRoomName());
    }

    self.selectChatRoom = function() {
        chatRoomsViewModel.selectChatRoom(self);
    }

    self.onKeyDown = function(d, e) {
        if(e.keyCode===13) {
            self.sendMessage();
        }
        return true;
    }
}
function GameCardViewModel(data) {
    var self = this;
    self.suit = ko.observable(data.Suit);
    self.rank = ko.observable(data.Rank);
    self.selected = ko.observable(false);

    self.cssClass = ko.computed(function() {
        if(self.selected()) {
            return "cardFront selected";
        }
        else {
            return "cardFront";
        }
    });

    self.select = function() {
        var isCurrentlySelected = self.selected();
        self.selected(!isCurrentlySelected);
    }
}
function GameLobbiesViewModel(connection) {
    var self = this;

    self.connection = connection;
    self.gameLobbies = ko.observableArray();

    self.getGameLobbies = function() {
        self.gameLobbies.removeAll();
        fetch(webAPIIPAddress + "/api/gamelobbies", {
            method: 'GET',
            credentials: 'include'
        }).then(response => {
            response.json().then(function(data) {
                data.forEach(function(element) {
                    console.log(element);
                    var gameLobby = new GameLobbyViewModel(connection, element);
                    console.log(gameLobby);
                    self.gameLobbies.push(gameLobby);
                });
            });
        })
    }
}
function GameLobbyViewModel(connection, data) {
    var self = this;
    
    self.connection = connection;
    self.gameLobbyMessage = ko.observable(null);
    self.gameLobbyID = ko.observable(null);
    self.gameLobbyName = ko.observable(null);
    self.hostUserName = ko.observable(null);
    self.maxRoomLimit = ko.observable(null);
    self.host = ko.observable(null);
    self.players = ko.observableArray();
    self.gameLobbyMessages = ko.observableArray();
    self.userCount = ko.observable(null);

    self.hand = ko.observableArray();
    self.rankClaim = ko.observable();
    console.log(data);

    self.maxRoomLimitOptions = ko.observableArray([4, 5, 6, 7, 8]);

    self.userCountLimitFraction = ko.computed(function() {
        return self.userCount() + "/" + self.maxRoomLimit();
    });

    self.hostInfo = ko.computed(function() {
        return "Host: " + self.hostUserName();
    });

    if(data != null) {
        self.gameLobbyID(data.gameLobbyID);
        self.gameLobbyName(data.gameLobbyName);
        self.hostUserName(data.hostUserName);
        self.userCount(data.userCount);
        self.maxRoomLimit(data.maxRoomLimit);
        console.log("From game lobby viewmodel" + data.gameLobbyID + data.gameLobbyName);
    }

    self.gameState = function() {
        self.connection.invoke("GameState", self.gameLobbyID());
    }

    self.startGame = function() {
        self.connection.invoke("GameLobbyStartGame", self.gameLobbyID());
    }   

    self.gameCallCheat = function() {
        self.connection.invoke("GameCallCheat", self.gameLobbyID());
    }

    self.gameEndTurn = function() {
        self.connection.invoke("GameEndTurn", self.gameLobbyID());
    }

    self.gameClaim = function() {
        var selectedCards = [];
        for(var i = 0; i < self.hand().length; i++) {
            if(self.hand()[i].selected()) {
                var card = { 
                    "Rank": self.hand()[i].rank(),
                    "Suit": self.hand()[i].suit()
                };
                selectedCards.push(card);
            }
        }
        var claims = [];
        for(var j = 0; j < selectedCards.length; j++) {
            var claim = { "Rank": self.rankClaim() };
            claims.push(claim);
        }
        self.connection.invoke("GameClaim", self.gameLobbyID(), claims, selectedCards);
    }

    self.leaveGameLobby = function() {
        self.connection.invoke("GameLobbyLeave", self.gameLobbyID());
    }

    self.joinGameLobby = function() {
        self.connection.invoke("GameLobbyJoin", self.gameLobbyID());
    }

    self.sendMessageGameLobby = function() {
        self.connection.invoke("GameLobbySendMessage", self.gameLobbyMessage(), self.gameLobbyID());
        self.gameLobbyMessage(null);
    }

    self.createGameLobby = function() {
        fetch(webAPIIPAddress + "/api/gamelobbies", {
            method: 'POST',
            headers: {
                Accept: 'application/json',
                'Content-Type': 'application/json',
            },
            credentials: 'include',
            body: JSON.stringify({
                gameLobbyName: self.gameLobbyName(),
                maxRoomLimit: self.maxRoomLimit(),
            }),
        }).then(response => {
            response.json().then(function(data) {
                console.log(data);
                self.connection.invoke("GameLobbyJoin", data.gameLobbyID);
            });
        });
    }

    self.onKeyDown = function(d, e) {
        if(e.keyCode===13) {
            self.sendMessageGameLobby();
        }
        return true;
    }

    self.goBack = function() {
        leaveGameCreation();
    }
}
function LoginViewModel(alertMessageViewModel) {
    var self = this;

    self.alertMessageViewModel = alertMessageViewModel;
    self.username = ko.observable(null);
    self.password = ko.observable(null);

    self.login = function() {
        if(self.username()==null || self.password()==null) {
            alertMessageViewModel.showLoginMissingInput();
            return;
        }

        fetch(webAPIIPAddress + "/api/authentication/login", {
            method: 'POST',
            headers: {
                Accept: 'application/json',
                'Content-Type': 'application/json',
            },
            credentials: 'include',
            body: JSON.stringify({
                username: self.username(),
                password: self.password(),
            })
        }).then(response => {
            if(response.ok) {
                loginSuccessful();
            }
            else {
                alertMessageViewModel.showLoginFailed();
            }
        });
    }
}
function RegisterViewModel(alertMessageViewModel) {
    var self = this;

    self.alertMessageViewModel = alertMessageViewModel;
    self.username = ko.observable(null);
    self.password = ko.observable(null);
    self.email = ko.observable(null);

    self.register = function() {
        if(self.username()==null || self.username()=="" || self.password()==null || self.password()=="" || self.email() == null) {
            alertMessageViewModel.showRegisterMissingInput();
            return;
        }

        fetch(webAPIIPAddress + "/api/authentication", {
            method: 'POST',
            headers: {
                Accept: 'application/json',
                'Content-Type': 'application/json',
            },
            credentials: 'include',
            body: JSON.stringify({
                username: self.username(),
                password: self.password(),
                email: self.email()
            }),
        }).then(response => {
            if(response.ok) {
                alertMessageViewModel.showRegisterSuccessful();
                registerSuccessful();
            }
            else {
                alertMessageViewModel.showRegisterUnsuccessful();
            }
        });
    }
}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZGVscy9DaGF0TWVzc2FnZS5qcyIsIm1vZGVscy9HYW1lTG9iYnkuanMiLCJtb2RlbHMvVXNlci5qcyIsInZpZXdtb2RlbHMvQWxlcnRNZXNzYWdlVmlld01vZGVsLmpzIiwidmlld21vZGVscy9DaGF0Um9vbXNWaWV3TW9kZWwuanMiLCJ2aWV3bW9kZWxzL0NoYXRSb29tVmlld01vZGVsLmpzIiwidmlld21vZGVscy9HYW1lQ2FyZFZpZXdNb2RlbC5qcyIsInZpZXdtb2RlbHMvR2FtZUxvYmJpZXNWaWV3TW9kZWwuanMiLCJ2aWV3bW9kZWxzL0dhbWVMb2JieVZpZXdNb2RlbC5qcyIsInZpZXdtb2RlbHMvTG9naW5WaWV3TW9kZWwuanMiLCJ2aWV3bW9kZWxzL1JlZ2lzdGVyVmlld01vZGVsLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDWkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDTEE7QUFDQTtBQUNBO0FDRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMvQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN2Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ25CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNuSEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNqQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiYXBwLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbImZ1bmN0aW9uIENoYXRNZXNzYWdlKGRhdGEpIHtcclxuICAgIHZhciBzZWxmID0gdGhpcztcclxuXHJcbiAgICBzZWxmLnVzZXJOYW1lID0gZGF0YS5Vc2VyTmFtZTtcclxuICAgIHNlbGYudXNlcklEID0gZGF0YS5Vc2VySUQ7XHJcbiAgICBzZWxmLm1lc3NhZ2VDb250ZW50ID0gZGF0YS5NZXNzYWdlQ29udGVudDtcclxuICAgIHNlbGYud2hlbkNyZWF0ZWQgPSBkYXRhLldoZW5DcmVhdGVkO1xyXG4gICAgY29uc29sZS5sb2codGhpcyk7XHJcblxyXG4gICAgc2VsZi51c2VyTmFtZUluZm8gPSBrby5jb21wdXRlZChmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gc2VsZi51c2VyTmFtZSArIFwiOiBcIlxyXG4gICAgfSk7XHJcbn0iLCJmdW5jdGlvbiBHYW1lTG9iYnkoZGF0YSkge1xyXG4gICAgdGhpcy5nYW1lTG9iYnlJRCA9IGRhdGEuZ2FtZUxvYmJ5SUQ7XHJcbiAgICB0aGlzLmdhbWVMb2JieU5hbWUgPSBkYXRhLmdhbWVMb2JieU5hbWU7XHJcbiAgICB0aGlzLmhvc3RVc2VyTmFtZSA9IGRhdGEuaG9zdFVzZXJOYW1lO1xyXG4gICAgY29uc29sZS5sb2codGhpcyk7XHJcbn0iLCJmdW5jdGlvbiBVc2VyKGRhdGEpIHtcclxuICAgIHRoaXMudXNlck5hbWUgPSBkYXRhLlVzZXJOYW1lO1xyXG59IiwiZnVuY3Rpb24gQWxlcnRNZXNzYWdlVmlld01vZGVsKCkge1xyXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xyXG5cclxuICAgIHNlbGYudGl0bGUgPSBrby5vYnNlcnZhYmxlKCk7XHJcbiAgICBzZWxmLm1lc3NhZ2UgPSBrby5vYnNlcnZhYmxlKCk7XHJcbiAgICBzZWxmLmlzVmlzaWJsZSA9IGtvLm9ic2VydmFibGUoZmFsc2UpO1xyXG5cclxuICAgIHNlbGYuY3NzRGlzcGxheSA9IGtvLmNvbXB1dGVkKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGlmKHNlbGYuaXNWaXNpYmxlKCkgPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gXCJpbmxpbmVcIjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBcIm5vbmVcIjtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICBzZWxmLmFjdGl2YXRlQ2FyZCA9IGtvLmNvbXB1dGVkKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGlmKHNlbGYuaXNWaXNpYmxlKCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFwiY2FyZCBhY3RpdmF0ZVwiO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIFwiY2FyZFwiO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIHNlbGYuc2hvd0xvZ2luRmFpbGVkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgc2VsZi50aXRsZShcIkxvZ2luIEVycm9yXCIpO1xyXG4gICAgICAgIHNlbGYubWVzc2FnZShcIkluY29ycmVjdCB1c2VybmFtZSBhbmQvb3IgcGFzc3dvcmRcIik7XHJcbiAgICAgICAgc2VsZi5pc1Zpc2libGUodHJ1ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgc2VsZi5zaG93TG9naW5NaXNzaW5nSW5wdXQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBzZWxmLnRpdGxlKFwiTG9naW4gRXJyb3JcIik7XHJcbiAgICAgICAgc2VsZi5tZXNzYWdlKFwiUGxlYXNlIGZpbGwgb3V0IHVzZXJuYW1lIGFuZCBwYXNzd29yZCBmaWVsZHNcIik7XHJcbiAgICAgICAgc2VsZi5pc1Zpc2libGUodHJ1ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgc2VsZi5zaG93UmVnaXN0ZXJNaXNzaW5nSW5wdXQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBzZWxmLnRpdGxlKFwiUmVnaXN0cmF0aW9uIEVycm9yXCIpO1xyXG4gICAgICAgIHNlbGYubWVzc2FnZShcIlBsZWFzZSBmaWxsIG91dCB1c2VybmFtZSwgZW1haWwgYW5kIHBhc3N3b3JkIGZpZWxkc1wiKTtcclxuICAgICAgICBzZWxmLmlzVmlzaWJsZSh0cnVlKTtcclxuICAgIH1cclxuXHJcbiAgICBzZWxmLnNob3dSZWdpc3RlclN1Y2Nlc3NmdWwgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBzZWxmLnRpdGxlKFwiUmVnaXN0cmF0aW9uIFN1Y2Nlc3NmdWxcIik7XHJcbiAgICAgICAgc2VsZi5tZXNzYWdlKFwiUmVnaXN0cmF0aW9uIGhhcyBzdWNjZXNzZnVsbHkgY29tcGxldGVkXCIpO1xyXG4gICAgICAgIHNlbGYuaXNWaXNpYmxlKHRydWUpO1xyXG4gICAgfVxyXG5cclxuICAgIHNlbGYuc2hvd1JlZ2lzdGVyVW5zdWNjZXNzZnVsID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgc2VsZi50aXRsZShcIlJlZ2lzdHJhdGlvbiBFcnJvclwiKTtcclxuICAgICAgICBzZWxmLm1lc3NhZ2UoXCJUaGVyZSBhbHJlYWR5IGV4aXN0cyBhIHVzZXIgd2l0aCB0aGUgc2FtZSB1c2VybmFtZSBvciBlbWFpbCFcIik7XHJcbiAgICAgICAgc2VsZi5pc1Zpc2libGUodHJ1ZSk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHNlbGYuY29uZmlybU1lc3NhZ2UgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBzZWxmLmlzVmlzaWJsZShmYWxzZSk7XHJcbiAgICB9XHJcbn0iLCJmdW5jdGlvbiBDaGF0Um9vbXNWaWV3TW9kZWwoY29ubmVjdGlvbikge1xyXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xyXG5cclxuICAgIHNlbGYuY29ubmVjdGlvbiA9IGNvbm5lY3Rpb247XHJcbiAgICBzZWxmLmNoYXRSb29tcyA9IGtvLm9ic2VydmFibGVBcnJheSgpO1xyXG4gICAgc2VsZi5vbmxpbmVVc2VycyA9IGtvLm9ic2VydmFibGVBcnJheSgpO1xyXG4gICAgc2VsZi5zZWxlY3RlZENoYXRSb29tID0ga28ub2JzZXJ2YWJsZShuZXcgQ2hhdFJvb21WaWV3TW9kZWwoc2VsZiwgY29ubmVjdGlvbiwge1wiY2hhdFJvb21OYW1lXCI6IFwiXCIsIFwicGFydGljaXBhbnRzXCI6IFtdfSkpO1xyXG5cclxuICAgIHNlbGYub25saW5lVXNlcnNDb3VudCA9IGtvLmNvbXB1dGVkKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBzZWxmLm9ubGluZVVzZXJzKCkubGVuZ3RoICsgXCIgUGxheWVyc1wiO1xyXG4gICAgfSk7XHJcblxyXG4gICAgc2VsZi5oYXNDaGF0ID0ga28uY29tcHV0ZWQoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgaWYoc2VsZi5jaGF0Um9vbXMoKS5sZW5ndGg+MCkge1xyXG4gICAgICAgICAgICByZXR1cm4gXCJpbmxpbmVcIjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBcIm5vbmVcIjtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICBzZWxmLmdldENoYXRSb29tcyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHNlbGYuY2hhdFJvb21zLnJlbW92ZUFsbCgpO1xyXG4gICAgICAgIGZldGNoKHdlYkFQSUlQQWRkcmVzcyArIFwiL2FwaS9jaGF0cm9vbXNcIiwge1xyXG4gICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICBjcmVkZW50aWFsczogJ2luY2x1ZGUnXHJcbiAgICAgICAgfSkudGhlbihyZXNwb25zZSA9PiB7XHJcbiAgICAgICAgICAgIHJlc3BvbnNlLmpzb24oKS50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgZGF0YS5mb3JFYWNoKGZ1bmN0aW9uKGVsZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLmNoYXRSb29tcy5wdXNoKG5ldyBDaGF0Um9vbVZpZXdNb2RlbChzZWxmLCBjb25uZWN0aW9uLCBlbGVtZW50KSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSlcclxuICAgIH1cclxuXHJcbiAgICBzZWxmLnNlbGVjdENoYXRSb29tID0gZnVuY3Rpb24oY2hhdFJvb20pIHtcclxuICAgICAgICBpZihzZWxmLnNlbGVjdGVkQ2hhdFJvb20oKSA9PSBjaGF0Um9vbSkge1xyXG4gICAgICAgICAgICBkZWFjdGl2YXRlQ3VycmVudENoYXRSb29tQ2FyZCgpO1xyXG4gICAgICAgICAgICBzZWxmLnNlbGVjdGVkQ2hhdFJvb20obmV3IENoYXRSb29tVmlld01vZGVsKHNlbGYsIGNvbm5lY3Rpb24sIHtcImNoYXRSb29tTmFtZVwiOiBcIlwiLCBcInBhcnRpY2lwYW50c1wiOiBbXX0pKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGFjdGl2YXRlQ3VycmVudENoYXRSb29tQ2FyZCgpO1xyXG4gICAgICAgICAgICBzZWxmLnNlbGVjdGVkQ2hhdFJvb20oY2hhdFJvb20pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgIH1cclxufSIsImZ1bmN0aW9uIENoYXRSb29tVmlld01vZGVsKGNoYXRSb29tc1ZpZXdNb2RlbCwgY29ubmVjdGlvbiwgZGF0YSkge1xyXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xyXG5cclxuICAgIHNlbGYuY2hhdFJvb21zVmlld01vZGVsID0gY2hhdFJvb21zVmlld01vZGVsO1xyXG4gICAgc2VsZi5jb25uZWN0aW9uID0gY29ubmVjdGlvbjtcclxuICAgIFxyXG4gICAgc2VsZi5jaGF0Um9vbU5hbWUgPSBrby5vYnNlcnZhYmxlKCk7XHJcbiAgICBzZWxmLmNoYXRNZXNzYWdlSW5wdXQgPSBrby5vYnNlcnZhYmxlKCk7XHJcbiAgICBzZWxmLmNoYXRNZXNzYWdlcyA9IGtvLm9ic2VydmFibGVBcnJheSgpO1xyXG4gICAgc2VsZi51c2VycyA9IGtvLm9ic2VydmFibGVBcnJheShkYXRhLnBhcnRpY2lwYW50cyk7XHJcbiAgICBzZWxmLmluQ2hhdCA9IGtvLm9ic2VydmFibGUoZmFsc2UpO1xyXG5cclxuICAgIHNlbGYudXNlcnNDb3VudCA9IGtvLmNvbXB1dGVkKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBzZWxmLnVzZXJzKCkubGVuZ3RoICsgXCIgVXNlcnNcIjtcclxuICAgIH0pO1xyXG5cclxuICAgIHNlbGYuY2hhdFJvb21OYW1lKGRhdGEuY2hhdFJvb21OYW1lKTtcclxuICAgIGNvbnNvbGUubG9nKHNlbGYuY2hhdFJvb21OYW1lKCkgKyBcIiBcIiArIGRhdGEpO1xyXG5cclxuICAgIHNlbGYuc2VuZE1lc3NhZ2UgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICB2YXIgbWVzc2FnZSA9IHNlbGYuY2hhdE1lc3NhZ2VJbnB1dCgpO1xyXG4gICAgICAgIHNlbGYuY2hhdE1lc3NhZ2VJbnB1dChcIlwiKTtcclxuICAgICAgICBzZWxmLmNvbm5lY3Rpb24uaW52b2tlKFwiQ2hhdFNlbmRNZXNzYWdlXCIsIG1lc3NhZ2UsIHNlbGYuY2hhdFJvb21OYW1lKCkpO1xyXG4gICAgfVxyXG5cclxuICAgIHNlbGYuam9pbkNoYXRSb29tID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgc2VsZi5jb25uZWN0aW9uLmludm9rZSgnQ2hhdFJvb21Kb2luJywgc2VsZi5jaGF0Um9vbU5hbWUoKSk7XHJcbiAgICB9XHJcblxyXG4gICAgc2VsZi5zZWxlY3RDaGF0Um9vbSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGNoYXRSb29tc1ZpZXdNb2RlbC5zZWxlY3RDaGF0Um9vbShzZWxmKTtcclxuICAgIH1cclxuXHJcbiAgICBzZWxmLm9uS2V5RG93biA9IGZ1bmN0aW9uKGQsIGUpIHtcclxuICAgICAgICBpZihlLmtleUNvZGU9PT0xMykge1xyXG4gICAgICAgICAgICBzZWxmLnNlbmRNZXNzYWdlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG59IiwiZnVuY3Rpb24gR2FtZUNhcmRWaWV3TW9kZWwoZGF0YSkge1xyXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgc2VsZi5zdWl0ID0ga28ub2JzZXJ2YWJsZShkYXRhLlN1aXQpO1xyXG4gICAgc2VsZi5yYW5rID0ga28ub2JzZXJ2YWJsZShkYXRhLlJhbmspO1xyXG4gICAgc2VsZi5zZWxlY3RlZCA9IGtvLm9ic2VydmFibGUoZmFsc2UpO1xyXG5cclxuICAgIHNlbGYuY3NzQ2xhc3MgPSBrby5jb21wdXRlZChmdW5jdGlvbigpIHtcclxuICAgICAgICBpZihzZWxmLnNlbGVjdGVkKCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFwiY2FyZEZyb250IHNlbGVjdGVkXCI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gXCJjYXJkRnJvbnRcIjtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICBzZWxmLnNlbGVjdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHZhciBpc0N1cnJlbnRseVNlbGVjdGVkID0gc2VsZi5zZWxlY3RlZCgpO1xyXG4gICAgICAgIHNlbGYuc2VsZWN0ZWQoIWlzQ3VycmVudGx5U2VsZWN0ZWQpO1xyXG4gICAgfVxyXG59IiwiZnVuY3Rpb24gR2FtZUxvYmJpZXNWaWV3TW9kZWwoY29ubmVjdGlvbikge1xyXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xyXG5cclxuICAgIHNlbGYuY29ubmVjdGlvbiA9IGNvbm5lY3Rpb247XHJcbiAgICBzZWxmLmdhbWVMb2JiaWVzID0ga28ub2JzZXJ2YWJsZUFycmF5KCk7XHJcblxyXG4gICAgc2VsZi5nZXRHYW1lTG9iYmllcyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHNlbGYuZ2FtZUxvYmJpZXMucmVtb3ZlQWxsKCk7XHJcbiAgICAgICAgZmV0Y2god2ViQVBJSVBBZGRyZXNzICsgXCIvYXBpL2dhbWVsb2JiaWVzXCIsIHtcclxuICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgY3JlZGVudGlhbHM6ICdpbmNsdWRlJ1xyXG4gICAgICAgIH0pLnRoZW4ocmVzcG9uc2UgPT4ge1xyXG4gICAgICAgICAgICByZXNwb25zZS5qc29uKCkudGhlbihmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICBkYXRhLmZvckVhY2goZnVuY3Rpb24oZWxlbWVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVsZW1lbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBnYW1lTG9iYnkgPSBuZXcgR2FtZUxvYmJ5Vmlld01vZGVsKGNvbm5lY3Rpb24sIGVsZW1lbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGdhbWVMb2JieSk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5nYW1lTG9iYmllcy5wdXNoKGdhbWVMb2JieSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSlcclxuICAgIH1cclxufSIsImZ1bmN0aW9uIEdhbWVMb2JieVZpZXdNb2RlbChjb25uZWN0aW9uLCBkYXRhKSB7XHJcbiAgICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgICBcclxuICAgIHNlbGYuY29ubmVjdGlvbiA9IGNvbm5lY3Rpb247XHJcbiAgICBzZWxmLmdhbWVMb2JieU1lc3NhZ2UgPSBrby5vYnNlcnZhYmxlKG51bGwpO1xyXG4gICAgc2VsZi5nYW1lTG9iYnlJRCA9IGtvLm9ic2VydmFibGUobnVsbCk7XHJcbiAgICBzZWxmLmdhbWVMb2JieU5hbWUgPSBrby5vYnNlcnZhYmxlKG51bGwpO1xyXG4gICAgc2VsZi5ob3N0VXNlck5hbWUgPSBrby5vYnNlcnZhYmxlKG51bGwpO1xyXG4gICAgc2VsZi5tYXhSb29tTGltaXQgPSBrby5vYnNlcnZhYmxlKG51bGwpO1xyXG4gICAgc2VsZi5ob3N0ID0ga28ub2JzZXJ2YWJsZShudWxsKTtcclxuICAgIHNlbGYucGxheWVycyA9IGtvLm9ic2VydmFibGVBcnJheSgpO1xyXG4gICAgc2VsZi5nYW1lTG9iYnlNZXNzYWdlcyA9IGtvLm9ic2VydmFibGVBcnJheSgpO1xyXG4gICAgc2VsZi51c2VyQ291bnQgPSBrby5vYnNlcnZhYmxlKG51bGwpO1xyXG5cclxuICAgIHNlbGYuaGFuZCA9IGtvLm9ic2VydmFibGVBcnJheSgpO1xyXG4gICAgc2VsZi5yYW5rQ2xhaW0gPSBrby5vYnNlcnZhYmxlKCk7XHJcbiAgICBjb25zb2xlLmxvZyhkYXRhKTtcclxuXHJcbiAgICBzZWxmLm1heFJvb21MaW1pdE9wdGlvbnMgPSBrby5vYnNlcnZhYmxlQXJyYXkoWzQsIDUsIDYsIDcsIDhdKTtcclxuXHJcbiAgICBzZWxmLnVzZXJDb3VudExpbWl0RnJhY3Rpb24gPSBrby5jb21wdXRlZChmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gc2VsZi51c2VyQ291bnQoKSArIFwiL1wiICsgc2VsZi5tYXhSb29tTGltaXQoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHNlbGYuaG9zdEluZm8gPSBrby5jb21wdXRlZChmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gXCJIb3N0OiBcIiArIHNlbGYuaG9zdFVzZXJOYW1lKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpZihkYXRhICE9IG51bGwpIHtcclxuICAgICAgICBzZWxmLmdhbWVMb2JieUlEKGRhdGEuZ2FtZUxvYmJ5SUQpO1xyXG4gICAgICAgIHNlbGYuZ2FtZUxvYmJ5TmFtZShkYXRhLmdhbWVMb2JieU5hbWUpO1xyXG4gICAgICAgIHNlbGYuaG9zdFVzZXJOYW1lKGRhdGEuaG9zdFVzZXJOYW1lKTtcclxuICAgICAgICBzZWxmLnVzZXJDb3VudChkYXRhLnVzZXJDb3VudCk7XHJcbiAgICAgICAgc2VsZi5tYXhSb29tTGltaXQoZGF0YS5tYXhSb29tTGltaXQpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiRnJvbSBnYW1lIGxvYmJ5IHZpZXdtb2RlbFwiICsgZGF0YS5nYW1lTG9iYnlJRCArIGRhdGEuZ2FtZUxvYmJ5TmFtZSk7XHJcbiAgICB9XHJcblxyXG4gICAgc2VsZi5nYW1lU3RhdGUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBzZWxmLmNvbm5lY3Rpb24uaW52b2tlKFwiR2FtZVN0YXRlXCIsIHNlbGYuZ2FtZUxvYmJ5SUQoKSk7XHJcbiAgICB9XHJcblxyXG4gICAgc2VsZi5zdGFydEdhbWUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBzZWxmLmNvbm5lY3Rpb24uaW52b2tlKFwiR2FtZUxvYmJ5U3RhcnRHYW1lXCIsIHNlbGYuZ2FtZUxvYmJ5SUQoKSk7XHJcbiAgICB9ICAgXHJcblxyXG4gICAgc2VsZi5nYW1lQ2FsbENoZWF0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgc2VsZi5jb25uZWN0aW9uLmludm9rZShcIkdhbWVDYWxsQ2hlYXRcIiwgc2VsZi5nYW1lTG9iYnlJRCgpKTtcclxuICAgIH1cclxuXHJcbiAgICBzZWxmLmdhbWVFbmRUdXJuID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgc2VsZi5jb25uZWN0aW9uLmludm9rZShcIkdhbWVFbmRUdXJuXCIsIHNlbGYuZ2FtZUxvYmJ5SUQoKSk7XHJcbiAgICB9XHJcblxyXG4gICAgc2VsZi5nYW1lQ2xhaW0gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICB2YXIgc2VsZWN0ZWRDYXJkcyA9IFtdO1xyXG4gICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCBzZWxmLmhhbmQoKS5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBpZihzZWxmLmhhbmQoKVtpXS5zZWxlY3RlZCgpKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgY2FyZCA9IHsgXHJcbiAgICAgICAgICAgICAgICAgICAgXCJSYW5rXCI6IHNlbGYuaGFuZCgpW2ldLnJhbmsoKSxcclxuICAgICAgICAgICAgICAgICAgICBcIlN1aXRcIjogc2VsZi5oYW5kKClbaV0uc3VpdCgpXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgc2VsZWN0ZWRDYXJkcy5wdXNoKGNhcmQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBjbGFpbXMgPSBbXTtcclxuICAgICAgICBmb3IodmFyIGogPSAwOyBqIDwgc2VsZWN0ZWRDYXJkcy5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICB2YXIgY2xhaW0gPSB7IFwiUmFua1wiOiBzZWxmLnJhbmtDbGFpbSgpIH07XHJcbiAgICAgICAgICAgIGNsYWltcy5wdXNoKGNsYWltKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgc2VsZi5jb25uZWN0aW9uLmludm9rZShcIkdhbWVDbGFpbVwiLCBzZWxmLmdhbWVMb2JieUlEKCksIGNsYWltcywgc2VsZWN0ZWRDYXJkcyk7XHJcbiAgICB9XHJcblxyXG4gICAgc2VsZi5sZWF2ZUdhbWVMb2JieSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHNlbGYuY29ubmVjdGlvbi5pbnZva2UoXCJHYW1lTG9iYnlMZWF2ZVwiLCBzZWxmLmdhbWVMb2JieUlEKCkpO1xyXG4gICAgfVxyXG5cclxuICAgIHNlbGYuam9pbkdhbWVMb2JieSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHNlbGYuY29ubmVjdGlvbi5pbnZva2UoXCJHYW1lTG9iYnlKb2luXCIsIHNlbGYuZ2FtZUxvYmJ5SUQoKSk7XHJcbiAgICB9XHJcblxyXG4gICAgc2VsZi5zZW5kTWVzc2FnZUdhbWVMb2JieSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHNlbGYuY29ubmVjdGlvbi5pbnZva2UoXCJHYW1lTG9iYnlTZW5kTWVzc2FnZVwiLCBzZWxmLmdhbWVMb2JieU1lc3NhZ2UoKSwgc2VsZi5nYW1lTG9iYnlJRCgpKTtcclxuICAgICAgICBzZWxmLmdhbWVMb2JieU1lc3NhZ2UobnVsbCk7XHJcbiAgICB9XHJcblxyXG4gICAgc2VsZi5jcmVhdGVHYW1lTG9iYnkgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBmZXRjaCh3ZWJBUElJUEFkZHJlc3MgKyBcIi9hcGkvZ2FtZWxvYmJpZXNcIiwge1xyXG4gICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICAgICAgICAgQWNjZXB0OiAnYXBwbGljYXRpb24vanNvbicsXHJcbiAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBjcmVkZW50aWFsczogJ2luY2x1ZGUnLFxyXG4gICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgICAgICAgICBnYW1lTG9iYnlOYW1lOiBzZWxmLmdhbWVMb2JieU5hbWUoKSxcclxuICAgICAgICAgICAgICAgIG1heFJvb21MaW1pdDogc2VsZi5tYXhSb29tTGltaXQoKSxcclxuICAgICAgICAgICAgfSksXHJcbiAgICAgICAgfSkudGhlbihyZXNwb25zZSA9PiB7XHJcbiAgICAgICAgICAgIHJlc3BvbnNlLmpzb24oKS50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgc2VsZi5jb25uZWN0aW9uLmludm9rZShcIkdhbWVMb2JieUpvaW5cIiwgZGF0YS5nYW1lTG9iYnlJRCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHNlbGYub25LZXlEb3duID0gZnVuY3Rpb24oZCwgZSkge1xyXG4gICAgICAgIGlmKGUua2V5Q29kZT09PTEzKSB7XHJcbiAgICAgICAgICAgIHNlbGYuc2VuZE1lc3NhZ2VHYW1lTG9iYnkoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgc2VsZi5nb0JhY2sgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBsZWF2ZUdhbWVDcmVhdGlvbigpO1xyXG4gICAgfVxyXG59IiwiZnVuY3Rpb24gTG9naW5WaWV3TW9kZWwoYWxlcnRNZXNzYWdlVmlld01vZGVsKSB7XHJcbiAgICB2YXIgc2VsZiA9IHRoaXM7XHJcblxyXG4gICAgc2VsZi5hbGVydE1lc3NhZ2VWaWV3TW9kZWwgPSBhbGVydE1lc3NhZ2VWaWV3TW9kZWw7XHJcbiAgICBzZWxmLnVzZXJuYW1lID0ga28ub2JzZXJ2YWJsZShudWxsKTtcclxuICAgIHNlbGYucGFzc3dvcmQgPSBrby5vYnNlcnZhYmxlKG51bGwpO1xyXG5cclxuICAgIHNlbGYubG9naW4gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBpZihzZWxmLnVzZXJuYW1lKCk9PW51bGwgfHwgc2VsZi5wYXNzd29yZCgpPT1udWxsKSB7XHJcbiAgICAgICAgICAgIGFsZXJ0TWVzc2FnZVZpZXdNb2RlbC5zaG93TG9naW5NaXNzaW5nSW5wdXQoKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZmV0Y2god2ViQVBJSVBBZGRyZXNzICsgXCIvYXBpL2F1dGhlbnRpY2F0aW9uL2xvZ2luXCIsIHtcclxuICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgICAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAgICAgICAgIEFjY2VwdDogJ2FwcGxpY2F0aW9uL2pzb24nLFxyXG4gICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgY3JlZGVudGlhbHM6ICdpbmNsdWRlJyxcclxuICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgICAgICAgICAgdXNlcm5hbWU6IHNlbGYudXNlcm5hbWUoKSxcclxuICAgICAgICAgICAgICAgIHBhc3N3b3JkOiBzZWxmLnBhc3N3b3JkKCksXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfSkudGhlbihyZXNwb25zZSA9PiB7XHJcbiAgICAgICAgICAgIGlmKHJlc3BvbnNlLm9rKSB7XHJcbiAgICAgICAgICAgICAgICBsb2dpblN1Y2Nlc3NmdWwoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGFsZXJ0TWVzc2FnZVZpZXdNb2RlbC5zaG93TG9naW5GYWlsZWQoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59IiwiZnVuY3Rpb24gUmVnaXN0ZXJWaWV3TW9kZWwoYWxlcnRNZXNzYWdlVmlld01vZGVsKSB7XHJcbiAgICB2YXIgc2VsZiA9IHRoaXM7XHJcblxyXG4gICAgc2VsZi5hbGVydE1lc3NhZ2VWaWV3TW9kZWwgPSBhbGVydE1lc3NhZ2VWaWV3TW9kZWw7XHJcbiAgICBzZWxmLnVzZXJuYW1lID0ga28ub2JzZXJ2YWJsZShudWxsKTtcclxuICAgIHNlbGYucGFzc3dvcmQgPSBrby5vYnNlcnZhYmxlKG51bGwpO1xyXG4gICAgc2VsZi5lbWFpbCA9IGtvLm9ic2VydmFibGUobnVsbCk7XHJcblxyXG4gICAgc2VsZi5yZWdpc3RlciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGlmKHNlbGYudXNlcm5hbWUoKT09bnVsbCB8fCBzZWxmLnVzZXJuYW1lKCk9PVwiXCIgfHwgc2VsZi5wYXNzd29yZCgpPT1udWxsIHx8IHNlbGYucGFzc3dvcmQoKT09XCJcIiB8fCBzZWxmLmVtYWlsKCkgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICBhbGVydE1lc3NhZ2VWaWV3TW9kZWwuc2hvd1JlZ2lzdGVyTWlzc2luZ0lucHV0KCk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZldGNoKHdlYkFQSUlQQWRkcmVzcyArIFwiL2FwaS9hdXRoZW50aWNhdGlvblwiLCB7XHJcbiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICAgICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgICAgICAgICBBY2NlcHQ6ICdhcHBsaWNhdGlvbi9qc29uJyxcclxuICAgICAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGNyZWRlbnRpYWxzOiAnaW5jbHVkZScsXHJcbiAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgICAgICAgICAgIHVzZXJuYW1lOiBzZWxmLnVzZXJuYW1lKCksXHJcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogc2VsZi5wYXNzd29yZCgpLFxyXG4gICAgICAgICAgICAgICAgZW1haWw6IHNlbGYuZW1haWwoKVxyXG4gICAgICAgICAgICB9KSxcclxuICAgICAgICB9KS50aGVuKHJlc3BvbnNlID0+IHtcclxuICAgICAgICAgICAgaWYocmVzcG9uc2Uub2spIHtcclxuICAgICAgICAgICAgICAgIGFsZXJ0TWVzc2FnZVZpZXdNb2RlbC5zaG93UmVnaXN0ZXJTdWNjZXNzZnVsKCk7XHJcbiAgICAgICAgICAgICAgICByZWdpc3RlclN1Y2Nlc3NmdWwoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGFsZXJ0TWVzc2FnZVZpZXdNb2RlbC5zaG93UmVnaXN0ZXJVbnN1Y2Nlc3NmdWwoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59Il19
